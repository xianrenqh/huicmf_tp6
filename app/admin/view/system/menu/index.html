<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>节点列表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    {include file='header'/}
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">
        <div class="layui-btn-group">
            <button class="layui-btn layui-btn-sm layuimini-btn-primary"><i class="fa fa-refresh"></i></button>
        </div>
        <table id="munu-table" lay-filter="munu-table"></table>
    </div>
</div>
<script type="text/html" id="switchTpl">
    <input type="checkbox" name="status" value="{{d.status}}" lay-skin="switch" lay-text="启用|禁用" lay-filter="sexDemo" {{ d.status==
           1 ? 'checked' : '' }}>
</script>
<script type="text/html" id="iconTpl">
    <i class="{{d.icon}}"></i>
</script>
<script type="text/html" id="optionTpl">
    <a class="layui-btn layui-btn-xs layui-btn-normal" data-open="system.menu/add?id=227" data-title="添加下级" data-full="true">添加下级</a>
    <a class="layui-btn layui-btn-xs layui-btn-success" data-open="system.menu/edit?id=227" data-title="编辑" data-full="true">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" data-request="system.menu/delete?id=227" data-title="确定删除？">删除</a>
</script>

{include file='footer'/}
<script>
  layui.use(['table', 'treetable'], function () {
    var $ = layui.jquery;
    var table = layui.table;
    var treetable = layui.treetable;

    // 渲染表格
    layer.load(2);
    treetable.render({
      treeColIndex: 1,
      treeSpid: 0,
      homdPid: 99999999,
      treeIdName: 'id',
      treePidName: 'pid',
      elem: '#munu-table',
      method: 'post',
      url: "{:url('system.menu/index')}",
      page: false,
      cols: [[
        {type: 'numbers'},
        {field: 'title', minWidth: 200, title: '权限名称'},
        {field: 'icon', width: 80, title: '图标', templet: '#iconTpl', align: 'center'},
        {field: 'href', title: '菜单url'},
        {
          field: 'is_home',
          width: 80,
          title: '类型',
          align: 'center',
          templet: function (d) {
            if (d.pid === 99999999) {
              return '<span class="layui-badge layui-bg-blue">首页</span>';
            }
            if (d.pid === 0) {
              return '<span class="layui-badge layui-bg-gray">模块</span>';
            } else {
              return '<span class="layui-badge-rim">菜单</span>';
            }
          }
        },
        {field: 'status', title: '状态', width: 95, templet: '#switchTpl',align: 'center'},
        {field: 'sort', width: 80, title: '排序', edit: 'text',align: 'center'},
        {
          width: 200,
          title: '操作',
          templet: '#optionTpl',
          align: 'center',
        }
      ]],
      done: function () {
        layer.closeAll('loading');
      }
    });

    $('#btn-expand').click(function () {
      treetable.expandAll('#munu-table');
    });

    $('#btn-fold').click(function () {
      treetable.foldAll('#munu-table');
    });

    //监听工具条
    table.on('tool(munu-table)', function (obj) {
      var data = obj.data;
      var layEvent = obj.event;

      if (layEvent === 'del') {
        layer.msg('删除' + data.id);
      } else if (layEvent === 'edit') {
        layer.msg('修改' + data.id);
      }
    });
  });
</script>
</body>
</html>